@using BabyCareProject.Dtos.SubscribeDtos
@model CreateSubscribeDto

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="footer-item">
    <h2 class="fw-bold mb-3"><span class="text-primary mb-0">Baby</span><span class="text-secondary">Care</span></h2>
    <p class="mb-4">
        E-posta Bültenimize Kaydolun
    </p>
    <div class="border border-primary p-3 rounded bg-light">
        <h5 class="mb-3">Abonelik</h5>
        <div class="position-relative mx-auto border border-primary rounded" style="max-width: 400px;">

            <form id="subscribeForm" method="post" asp-action="AddSubscriber" asp-controller="UILayout" asp-area="Layouts">
                <input id="subscribeEmailInput" asp-for="Email" class="form-control border-0 w-100 py-3 ps-4 pe-5" type="text" placeholder="Email...">
                <button type="submit" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2 text-white">Kaydol</button>
            </form>

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#subscribeForm').on('submit', function (e) {
            e.preventDefault(); // Formun varsayılan gönderimini engelle (sayfa yenilenmesin)
            var form = $(this);

            var emailInput = $('#subscribeEmailInput'); 
            var emailValue = emailInput.val();

            $.ajax({
                type: form.attr('method'), // POST
                url: form.attr('action'),  // /Layouts/UILayout/AddSubscriber
                data: form.serialize(),    // Form verilerini gönder (Email=....&__RequestVerificationToken=...)
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: response.message || 'Abonelik isteğiniz alındı!', // Controller'dan gelen mesajı kullan
                            showConfirmButton: false,
                            timer: 2000 // 2 saniye sonra otomatik kapanır
                        });
                        emailInput.val(''); // Input alanını temizle
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Hata!',
                            text: response.message || 'Bir sorun oluştu.',
                            confirmButtonColor: '#3085d6'
                        });
                    }
                },
            });
        });
    });
</script>